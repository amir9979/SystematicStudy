public boolean equals(Object obj) {
if (!super.equals(obj)) {
return false;
}

if (getRank() == 0 &amp;&amp; !getClass().equals(obj.getClass())) // already true for zero-rank dataset
Dataset bds = b instanceof Dataset ? (Dataset) b : DatasetFactory.createFromObject(b);
boolean useLong = bds.getElementClass().equals(Long.class);
if (bds.getSize() == 1) {


for (int ym = 0; ym < granularity; ym++)
for (int zm = 0; zm < granularity; zm++)
if (Logic.theGrid.getTile(x * granularity + xm, y * granularity + ym, z * granularity + zm) != -1)
int rz = (int)p3d.z;

if (x != 0 &amp;&amp; rx == (int)origDest.x) {p3d.x += x; x = 0;}
if (y != 0 &amp;&amp; ry == (int)origDest.y) {p3d.y += y; y = 0;}


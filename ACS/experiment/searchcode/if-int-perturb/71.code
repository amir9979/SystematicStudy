float ny = m10*x + m11*y;
nx /= scale * stretch;
ny /= scale;

int a = rgb &amp; 0xff000000;
if (colormap != null) {
grn *= Math.max(brownLayer, greenLayer) * grnPerturb;
int r = (rgb >> 16) &amp; 0xff;
int g = (rgb >> 8) &amp; 0xff;


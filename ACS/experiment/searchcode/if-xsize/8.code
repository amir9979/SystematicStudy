// o.x+t*d.x = center.x+xsize/2 (or center.x-xsize/2)
if (Math.abs(d.x) > EPSILON)
{
t1 = (center.x + xsize / 2 - o.x) / d.x;
xt = (2 * (x - center.x) + xsize) / (2 * xsize);
if (t1 > 0 &amp;&amp; t1 < t &amp;&amp; zt * (1 - zt) >= 0 &amp;&amp; xt * (1 - xt) >= 0)


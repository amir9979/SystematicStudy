double uN=(l2.p2.y-l2.p1.y)*(p2.x-p1.x)-(l2.p2.x-l2.p1.x)*(p2.y-p1.y);

if (uN!=0.0) {
double ua=uaT/uN;
double ub=ubT/uN;
double x=p1.x+ua*(p2.x-p1.x);
double uN=(l2.p2.y-l2.p1.y)*(p2.x-p1.x)-(l2.p2.x-l2.p1.x)*(p2.y-p1.y);

if (uN!=0.0) {
double ua=uaT/uN;
double ub=ubT/uN;
double x=p1.x+ua*(p2.x-p1.x);


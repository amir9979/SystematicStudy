public static void encode(InputStream in, Writer out) throws IOException {
int read;
int index;
int written = 0;
while (true) {
read = in.read();
if (read == -1) {


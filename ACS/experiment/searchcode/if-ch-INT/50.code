StringBuilder sb = new StringBuilder();

for( int i = 0; i < src.length(); i++ )
{
int ch = src.charAt(i);

if( !isXMLNameChar(ch) ||
(ch == &#39;_&#39; &amp;&amp; i < src.length()-5 &amp;&amp; src.charAt(i+1) == &#39;x&#39; &amp;&amp;


boolean mergeFirst = floor != null &amp;&amp; id == floor.getSecond();
boolean mergeSecond = ceiling != null &amp;&amp; id == ceiling.getFirst()-1;

if(mergeFirst)
final Pair<Integer, Integer> range = takenRanges.floor(emptyRange(id));

if(range == null || range.getSecond() <= id)

